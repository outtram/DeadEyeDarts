<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dungeon of Darts - DeadEyeGames</title>

    <link rel="stylesheet" href="/static/css/cyberpunk.css">
    <link rel="stylesheet" href="/games/dungeon-crawl/dungeon.css">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="/static/js/darts-client.js"></script>
</head>
<body>
    <div class="game-container">
        <!-- Header -->
        <div class="game-header">
            <a href="/" class="btn btn-secondary back-btn">‚Üê Flee</a>
            <div class="header-title">
                <h1>DUNGEON OF DARTS</h1>
                <p class="subtitle">Five Heroes. One Dungeon. Endless Glory.</p>
            </div>
            <div id="connection-status" class="status-indicator disconnected">
                <span class="status-dot"></span>
                <span class="status-text">Connecting...</span>
            </div>
        </div>

        <!-- Title Screen -->
        <div id="title-screen" class="screen active">
            <div class="title-panel">
                <div class="title-art">
                    <pre class="dungeon-ascii">
    _______________
   /               \
  /  DUNGEON OF    \
 /    D A R T S     \
|   _______________  |
|  |  ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó   |  |
|  |  ‚ïë ‚öî üéØ ‚öî ‚ïë   |  |
|  |  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù   |  |
|  |_______________|  |
|_____________________|
   ||             ||
   ||  THE FIVE   ||
   ||   LEGENDS   ||
   ||_____________||
                    </pre>
                </div>

                <h2>The Heroes Assemble</h2>
                <p class="story-text">
                    Five legendary warriors have gathered at the entrance of the
                    <span class="highlight">Dungeon of Darts</span>. Dark creatures lurk within,
                    guarding treasures beyond imagination. Only the most accurate throwers
                    will survive...
                </p>

                <!-- Configuration Panel -->
                <div class="config-panel">
                    <h3 class="config-title">PARTY CONFIGURATION</h3>

                    <!-- Player Count -->
                    <div class="config-row">
                        <label class="config-label">Number of Heroes:</label>
                        <div class="config-control">
                            <button class="btn btn-small" id="decrease-players">-</button>
                            <span id="player-count" class="config-value">5</span>
                            <button class="btn btn-small" id="increase-players">+</button>
                        </div>
                    </div>

                    <!-- Darts Per Turn -->
                    <div class="config-row">
                        <label class="config-label">Darts Per Turn:</label>
                        <div class="config-control">
                            <button class="btn btn-small" id="decrease-darts">-</button>
                            <span id="darts-per-turn" class="config-value">3</span>
                            <button class="btn btn-small" id="increase-darts">+</button>
                        </div>
                    </div>
                </div>

                <!-- Hero Roster (editable names) -->
                <div id="hero-roster" class="hero-roster">
                    <div class="hero-card" data-hero="0" data-active="true">
                        <div class="hero-icon">‚öîÔ∏è</div>
                        <input type="text" class="hero-name-input" value="TROY" maxlength="10">
                        <div class="hero-class">The Blade Master</div>
                    </div>
                    <div class="hero-card" data-hero="1" data-active="true">
                        <div class="hero-icon">üõ°Ô∏è</div>
                        <input type="text" class="hero-name-input" value="DEANO" maxlength="10">
                        <div class="hero-class">The Tank</div>
                    </div>
                    <div class="hero-card" data-hero="2" data-active="true">
                        <div class="hero-icon">üî•</div>
                        <input type="text" class="hero-name-input" value="DAVE" maxlength="10">
                        <div class="hero-class">The Fire Mage</div>
                    </div>
                    <div class="hero-card" data-hero="3" data-active="true">
                        <div class="hero-icon">üèπ</div>
                        <input type="text" class="hero-name-input" value="JACK" maxlength="10">
                        <div class="hero-class">The Ranger</div>
                    </div>
                    <div class="hero-card" data-hero="4" data-active="true">
                        <div class="hero-icon">‚ö°</div>
                        <input type="text" class="hero-name-input" value="MICK" maxlength="10">
                        <div class="hero-class">The Storm Caller</div>
                    </div>
                </div>

                <button id="start-game-btn" class="btn btn-primary btn-large">
                    ENTER THE DUNGEON
                </button>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <!-- Dungeon Level Info -->
            <div class="dungeon-info">
                <div class="level-indicator">
                    <span class="level-label">FLOOR</span>
                    <span id="current-floor" class="level-number">1</span>
                </div>
                <div class="room-indicator">
                    <span class="room-label">ROOM</span>
                    <span id="current-room" class="room-number">1</span>
                    <span class="room-total">/ 5</span>
                </div>
                <div class="party-gold">
                    <span class="gold-icon">üí∞</span>
                    <span id="party-gold">0</span>
                </div>
                <button id="settings-btn" class="btn btn-small settings-btn" title="Settings">‚öôÔ∏è</button>
            </div>

            <!-- In-Game Settings Modal -->
            <div id="settings-modal" class="settings-modal hidden">
                <div class="settings-content">
                    <h3>GAME SETTINGS</h3>
                    <div class="config-row">
                        <label class="config-label">Darts Per Turn:</label>
                        <div class="config-control">
                            <button class="btn btn-small" id="ig-decrease-darts">-</button>
                            <span id="ig-darts-per-turn" class="config-value">3</span>
                            <button class="btn btn-small" id="ig-increase-darts">+</button>
                        </div>
                    </div>
                    <div class="settings-info">
                        <p>Darts Remaining: <span id="darts-remaining">3</span></p>
                        <p>Current Hero: <span id="current-hero-name">TROY</span></p>
                    </div>
                    <div class="settings-buttons">
                        <button id="resume-btn" class="btn btn-primary">RESUME</button>
                        <button id="quit-btn" class="btn btn-secondary">QUIT TO MENU</button>
                    </div>
                </div>
            </div>

            <!-- Dungeon View -->
            <div class="dungeon-view">
                <!-- The Dungeon Room -->
                <div id="dungeon-room" class="dungeon-room">
                    <div class="room-background">
                        <div class="torch left"></div>
                        <div class="torch right"></div>
                        <div class="stone-wall"></div>
                    </div>

                    <!-- Monster Display Area -->
                    <div id="monster-arena" class="monster-arena">
                        <!-- Monster spawns here -->
                    </div>

                    <!-- Combat Target Indicators (multiple creatures) -->
                    <div id="target-indicators" class="target-indicators">
                        <!-- Target indicators populated by JS for each creature -->
                    </div>
                </div>

                <!-- Combat Log -->
                <div id="combat-log" class="combat-log">
                    <div class="log-header">BATTLE LOG</div>
                    <div id="log-entries" class="log-entries">
                        <!-- Log entries appear here -->
                    </div>
                </div>
            </div>

            <!-- Party Status -->
            <div id="party-status" class="party-status">
                <!-- Hero cards populated by JS -->
            </div>

            <!-- Current Attacker & Spell Panel -->
            <div class="attacker-spell-row">
                <div id="current-attacker" class="current-attacker">
                    <span class="attacker-label">NOW ATTACKING:</span>
                    <span id="attacker-name" class="attacker-name">TROY</span>
                    <span id="attacker-class" class="attacker-class">The Blade Master</span>
                    <div class="darts-remaining-display">
                        <span class="darts-label">DARTS:</span>
                        <span id="darts-remaining-display" class="darts-count">üéØ üéØ üéØ</span>
                    </div>
                </div>

                <!-- Spell Panel -->
                <div id="spell-panel" class="spell-panel">
                    <!-- Current hero's spell info -->
                </div>
            </div>

            <!-- Active Buffs Display -->
            <div id="buff-display" class="buff-display">
                <!-- Active power-up buffs shown here -->
            </div>

            <!-- Floating Damage Numbers -->
            <div id="damage-container" class="damage-container"></div>
        </div>

        <!-- Victory Screen -->
        <div id="victory-screen" class="screen">
            <div class="victory-panel">
                <h2 class="victory-title">DUNGEON CONQUERED!</h2>
                <div class="victory-art">üèÜ‚öîÔ∏èüéØ‚öîÔ∏èüèÜ</div>

                <div id="victory-stats" class="victory-stats">
                    <!-- Stats populated by JS -->
                </div>

                <div id="hero-scores" class="hero-scores">
                    <!-- Individual hero scores -->
                </div>

                <div id="mvp-section" class="mvp-section">
                    <!-- MVP award -->
                </div>

                <button id="play-again-btn" class="btn btn-primary btn-large">
                    ENTER AGAIN
                </button>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div id="gameover-screen" class="screen">
            <div class="gameover-panel">
                <h2 class="gameover-title">THE PARTY HAS FALLEN!</h2>
                <div class="gameover-art">üíÄ‚ò†Ô∏èüíÄ</div>

                <p class="gameover-text">
                    The dungeon claims another group of adventurers...
                </p>

                <div id="gameover-stats" class="gameover-stats">
                    <!-- Stats populated by JS -->
                </div>

                <button id="retry-btn" class="btn btn-primary btn-large">
                    TRY AGAIN
                </button>
            </div>
        </div>
    </div>

    <script src="/games/dungeon-crawl/dungeon.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize darts client
            DartsClient.init({
                onDartThrown: (dart) => {
                    if (DungeonCrawl.isGameActive()) {
                        DungeonCrawl.handleDartThrow(dart);
                    }
                },
                onDartsStatus: (connected) => {
                    const startBtn = document.getElementById('start-game-btn');
                    if (startBtn) {
                        startBtn.disabled = !connected;
                        if (!connected) {
                            startBtn.textContent = 'AWAITING CONNECTION...';
                        } else {
                            startBtn.textContent = 'ENTER THE DUNGEON';
                        }
                    }
                }
            });

            // =============================================
            // TITLE SCREEN CONFIGURATION
            // =============================================
            let playerCount = 5;
            let dartsPerTurn = 3;

            const playerCountEl = document.getElementById('player-count');
            const dartsPerTurnEl = document.getElementById('darts-per-turn');
            const heroCards = document.querySelectorAll('.hero-card');

            function updatePlayerCount(delta) {
                playerCount = Math.max(1, Math.min(5, playerCount + delta));
                playerCountEl.textContent = playerCount;

                // Show/hide hero cards based on count
                heroCards.forEach((card, index) => {
                    if (index < playerCount) {
                        card.dataset.active = 'true';
                        card.classList.remove('inactive');
                    } else {
                        card.dataset.active = 'false';
                        card.classList.add('inactive');
                    }
                });
            }

            function updateDartsPerTurn(delta) {
                dartsPerTurn = Math.max(1, Math.min(3, dartsPerTurn + delta));
                dartsPerTurnEl.textContent = dartsPerTurn;
            }

            // Player count buttons
            document.getElementById('decrease-players')?.addEventListener('click', () => updatePlayerCount(-1));
            document.getElementById('increase-players')?.addEventListener('click', () => updatePlayerCount(1));

            // Darts per turn buttons
            document.getElementById('decrease-darts')?.addEventListener('click', () => updateDartsPerTurn(-1));
            document.getElementById('increase-darts')?.addEventListener('click', () => updateDartsPerTurn(1));

            // =============================================
            // GAME CONTROLS
            // =============================================
            document.getElementById('start-game-btn')?.addEventListener('click', () => {
                DungeonCrawl.startGame();
            });

            document.getElementById('play-again-btn')?.addEventListener('click', () => {
                DungeonCrawl.resetGame();
            });

            document.getElementById('retry-btn')?.addEventListener('click', () => {
                DungeonCrawl.resetGame();
            });

            // =============================================
            // IN-GAME SETTINGS MENU
            // =============================================
            document.getElementById('settings-btn')?.addEventListener('click', () => {
                DungeonCrawl.toggleSettings();
            });

            document.getElementById('resume-btn')?.addEventListener('click', () => {
                DungeonCrawl.toggleSettings();
            });

            document.getElementById('quit-btn')?.addEventListener('click', () => {
                DungeonCrawl.resetGame();
            });

            // In-game darts adjustment
            document.getElementById('ig-decrease-darts')?.addEventListener('click', () => {
                DungeonCrawl.updateInGameDarts(-1);
            });

            document.getElementById('ig-increase-darts')?.addEventListener('click', () => {
                DungeonCrawl.updateInGameDarts(1);
            });
        });
    </script>
</body>
</html>
