<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Station Siege - DeadEyeGames</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/cyberpunk.css">
    <link rel="stylesheet" href="/games/station-siege/station-siege.css">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="/static/js/darts-client.js"></script>
</head>
<body class="crt-effect">
    <div class="game-container">
        <!-- Header -->
        <div class="game-header">
            <a href="/" class="btn btn-secondary back-btn">â† Retreat</a>
            <div class="header-title">
                <h1>STATION SIEGE</h1>
                <p class="subtitle">Defend the Station. Throw True.</p>
            </div>
            <div id="connection-status" class="status-indicator disconnected">
                <span class="status-dot"></span>
                <span class="status-text">Connecting...</span>
            </div>
        </div>

        <!-- Title Screen -->
        <div id="title-screen" class="screen active">
            <div class="title-panel">
                <div class="title-art">
                    <pre class="station-ascii">
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘     â—‡â—‡â—‡ STATION SIEGE â—‡â—‡â—‡    â•‘
        â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
        â•‘                              â•‘
        â•‘      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â•‘
        â•‘   â—„â•â•â•ªâ•â•â•â•â•â•¦â•â•â•â•â•â•ªâ•â•â–º        â•‘
        â•‘      â”‚  â–“â–“â–“â•‘â–“â–“â–“  â”‚          â•‘
        â•‘   â—„â•â•â•ªâ•â•â•â•â•â•©â•â•â•â•â•â•ªâ•â•â–º        â•‘
        â•‘      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â•‘
        â•‘                              â•‘
        â•‘    INCOMING HOSTILES: âˆ      â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    </pre>
                </div>

                <h2>DEFEND THE STATION</h2>
                <p class="story-text">
                    Hostile spacecraft are converging on <span class="highlight">Deep Space Station Omega</span>.
                    You are the last line of defense. Each enemy displays a number -
                    hit that number on your dartboard to destroy them before they reach the station!
                </p>

                <div class="instructions">
                    <div class="instruction-row">
                        <span class="instruction-icon">ğŸ¯</span>
                        <span>Hit the NUMBER shown on each hostile to damage it</span>
                    </div>
                    <div class="instruction-row">
                        <span class="instruction-icon">Ã—2</span>
                        <span>DOUBLES deal 2x damage</span>
                    </div>
                    <div class="instruction-row">
                        <span class="instruction-icon">Ã—3</span>
                        <span>TRIPLES deal 3x damage</span>
                    </div>
                    <div class="instruction-row">
                        <span class="instruction-icon">ğŸ±</span>
                        <span>BULLSEYE uses Plasma Shots for 3x damage</span>
                    </div>
                </div>

                <!-- Game Mode Selection -->
                <div class="mode-selection">
                    <div class="mode-tabs">
                        <button class="mode-tab active" data-mode="solo">SOLO</button>
                        <button class="mode-tab" data-mode="coop">CO-OP</button>
                    </div>

                    <!-- Solo Mode Options -->
                    <div id="solo-options" class="mode-options active">
                        <div class="seed-section">
                            <label class="seed-label">GAME SEED</label>
                            <div class="seed-input-row">
                                <input type="text" id="seed-input" class="seed-input" placeholder="Random" maxlength="12">
                                <button id="random-seed-btn" class="btn btn-secondary btn-small">ğŸ²</button>
                            </div>
                            <p class="seed-hint">Same seed = same game. Share with friends to compete!</p>
                        </div>
                        <div class="player-name-section">
                            <label class="seed-label">YOUR NAME</label>
                            <input type="text" id="player-name" class="seed-input" placeholder="Player" maxlength="16">
                        </div>
                    </div>

                    <!-- Co-Op Mode Options -->
                    <div id="coop-options" class="mode-options">
                        <div class="coop-section">
                            <label class="seed-label">YOUR NAME</label>
                            <input type="text" id="coop-player-name" class="seed-input" placeholder="Player" maxlength="16">
                        </div>
                        <div class="coop-section">
                            <label class="seed-label">ROOM CODE</label>
                            <div class="seed-input-row">
                                <input type="text" id="room-code" class="seed-input" placeholder="Enter code" maxlength="8">
                                <button id="create-room-btn" class="btn btn-secondary btn-small">CREATE</button>
                            </div>
                        </div>
                        <div id="players-list" class="players-list">
                            <!-- Connected players shown here -->
                        </div>
                        <p class="seed-hint">All players defend the same station together!</p>
                    </div>
                </div>

                <button id="start-game-btn" class="btn btn-primary btn-large glow-pulse">
                    LAUNCH DEFENSE
                </button>

                <!-- Leaderboard Preview -->
                <div class="leaderboard-preview">
                    <h4>TOP SCORES</h4>
                    <div id="leaderboard-list" class="leaderboard-list">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Game Screen -->
        <div id="game-screen" class="screen">
            <div class="game-layout">
                <!-- Left Side: Battle Canvas -->
                <div class="battle-section">
                    <div class="battle-header">
                        <div class="round-display">
                            <span class="label">ROUND</span>
                            <span id="round-number" class="value">1</span>
                        </div>
                        <div class="seed-display">
                            <span class="label">SEED</span>
                            <span id="current-seed" class="value seed-value">------</span>
                        </div>
                        <div id="alert-status" class="alert-status warning">
                            <span class="alert-text">WARNING</span>
                        </div>
                        <div class="score-display">
                            <span class="label">SCORE</span>
                            <span id="score-value" class="value">0</span>
                        </div>
                    </div>

                    <canvas id="battle-canvas" width="600" height="500"></canvas>

                    <!-- Station Status Bar -->
                    <div class="station-status">
                        <div class="shields-display">
                            <span class="label">SHIELDS</span>
                            <div class="shield-bar">
                                <div id="shield-fill" class="shield-fill" style="width: 100%"></div>
                            </div>
                            <span id="shield-count" class="shield-count">5/5</span>
                        </div>
                    </div>

                    <!-- Announcement Banner -->
                    <div id="announcement" class="announcement hidden">
                        <span id="announcement-text"></span>
                    </div>
                </div>

                <!-- Right Side: Dartboard & Armory -->
                <div class="control-section">
                    <!-- Energy Cells (darts remaining) -->
                    <div class="energy-display">
                        <span class="label">ENERGY CELLS</span>
                        <div id="energy-cells" class="energy-cells">
                            <span class="cell active">â—†</span>
                            <span class="cell active">â—†</span>
                            <span class="cell active">â—†</span>
                        </div>
                    </div>

                    <!-- Armory (power-ups) -->
                    <div class="armory-panel">
                        <div class="armory-header">
                            <span class="label">ARMORY</span>
                            <span id="armory-count" class="armory-count">0/6</span>
                        </div>
                        <div id="armory-grid" class="armory-grid">
                            <!-- Power-ups appear here -->
                        </div>
                    </div>

                    <!-- Dartboard -->
                    <div class="dartboard-container">
                        <svg id="dartboard" viewBox="0 0 400 400" class="dartboard">
                            <!-- Dartboard will be generated by JS -->
                        </svg>
                    </div>

                    <!-- Active Effects -->
                    <div id="active-effects" class="active-effects">
                        <!-- EMP, Plasma active indicators -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div id="gameover-screen" class="screen">
            <div class="gameover-panel">
                <h2 class="gameover-title">STATION DESTROYED</h2>
                <div class="gameover-art">
                    <pre class="explosion-ascii">
     â•² â”‚ â•±
    â”€â”€ â—† â”€â”€
     â•± â”‚ â•²
   BOOM!
                    </pre>
                </div>

                <div id="gameover-stats" class="gameover-stats">
                    <!-- Stats populated by JS -->
                </div>

                <button id="retry-btn" class="btn btn-primary btn-large">
                    RETRY MISSION
                </button>
            </div>
        </div>
    </div>

    <script src="/games/station-siege/station-siege.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let currentMode = 'solo';

            // Initialize darts client
            DartsClient.init({
                onDartThrown: (dart) => {
                    if (StationSiege.isGameActive()) {
                        StationSiege.handleDartThrow(dart);
                    }
                },
                onDartsStatus: (connected) => {
                    const startBtn = document.getElementById('start-game-btn');
                    if (startBtn) {
                        startBtn.disabled = !connected;
                        if (!connected) {
                            startBtn.textContent = 'AWAITING SIGNAL...';
                        } else {
                            startBtn.textContent = 'LAUNCH DEFENSE';
                        }
                    }
                }
            });

            // Mode tab switching
            document.querySelectorAll('.mode-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.mode-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.mode-options').forEach(o => o.classList.remove('active'));
                    tab.classList.add('active');
                    currentMode = tab.dataset.mode;
                    document.getElementById(`${currentMode}-options`).classList.add('active');
                    StationSiege.setGameMode(currentMode);
                });
            });

            // Random seed button
            document.getElementById('random-seed-btn')?.addEventListener('click', () => {
                const seed = Math.floor(Math.random() * 1000000).toString().padStart(6, '0');
                document.getElementById('seed-input').value = seed;
            });

            // Start game button
            document.getElementById('start-game-btn')?.addEventListener('click', () => {
                // Set player name
                const nameField = currentMode === 'solo'
                    ? document.getElementById('player-name')
                    : document.getElementById('coop-player-name');
                if (nameField && nameField.value.trim()) {
                    StationSiege.setPlayerName(nameField.value.trim());
                }
                StationSiege.startGame();
            });

            // Retry button
            document.getElementById('retry-btn')?.addEventListener('click', () => {
                StationSiege.startGame();
            });

            // Create room button (for coop)
            document.getElementById('create-room-btn')?.addEventListener('click', () => {
                const roomInput = document.getElementById('room-code');
                let roomCode = roomInput.value.trim();
                if (!roomCode) {
                    // Generate random room code
                    roomCode = Math.random().toString(36).substring(2, 8).toUpperCase();
                    roomInput.value = roomCode;
                }
                // For now, just show a message - full multiplayer requires server support
                alert(`Room "${roomCode}" created! Share this code with friends.\n\nNote: Full multiplayer requires the server to be hosted online.`);
            });

            // Load leaderboard on startup
            loadLeaderboard();

            function loadLeaderboard() {
                const leaderboard = StationSiege.getLeaderboard();
                const list = document.getElementById('leaderboard-list');
                if (list && leaderboard.length > 0) {
                    list.innerHTML = leaderboard.slice(0, 5).map((entry, i) => `
                        <div class="leaderboard-entry">
                            <span class="rank">#${i + 1}</span>
                            <span class="name">${entry.player || 'Anonymous'}</span>
                            <span class="score">${entry.score}</span>
                            <span class="seed">[${entry.seed?.toString().padStart(6, '0') || '------'}]</span>
                        </div>
                    `).join('');
                } else if (list) {
                    list.innerHTML = '<div class="no-scores">No scores yet. Be the first!</div>';
                }
            }
        });
    </script>
</body>
</html>
